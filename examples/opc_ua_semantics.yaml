# OPC UA Semantic Fields Example
# Demonstrates valid_range, resolution, and unece unit codes

name: opc_ua_sensor
version: 1
description: "Sensor with OPC UA semantic annotations for industrial interoperability"
endian: big

fields:
  - name: temperature
    type: s16
    div: 100
    unit: "°C"
    valid_range: [-40, 85]    # Operating range - flags out-of-range values
    resolution: 0.01          # 0.01°C resolution
    unece: "CEL"              # UNECE code for Celsius
    semantic:
      ipso: 3303
    
  - name: humidity
    type: u8
    mult: 0.5
    unit: "%RH"
    valid_range: [0, 100]     # Humidity 0-100%
    resolution: 0.5           # 0.5% steps
    unece: "P1"               # UNECE code for percent
    semantic:
      ipso: 3304
    
  - name: pressure
    type: u16
    mult: 10
    unit: "Pa"
    valid_range: [30000, 110000]  # ~300-1100 hPa (typical atmospheric)
    resolution: 10
    unece: "PAL"              # UNECE code for Pascal
    semantic:
      ipso: 3323
    
  - name: battery_voltage
    type: u16
    div: 1000
    unit: "V"
    valid_range: [2.0, 3.6]   # Typical LiPo range
    resolution: 0.001
    unece: "VLT"              # UNECE code for Volt
    semantic:
      ipso: 3316

# Test payload calculations:
# temperature: s16, div 100 -> raw = temp * 100
# humidity: u8, mult 0.5 -> raw = hum / 0.5 = hum * 2
# pressure: u16, mult 10 -> raw = pres / 10
# battery: u16, div 1000 -> raw = volt * 1000

test_vectors:
  - name: normal_reading
    description: "All values within valid range"
    # temp=23.45 -> raw=2345=0x0929
    # hum=65% -> raw=130=0x82
    # pres=100000Pa -> raw=10000=0x2710
    # batt=3.3V -> raw=3300=0x0CE4
    payload: "09 29 82 27 10 0C E4"
    expected:
      temperature: 23.45
      humidity: 65.0
      pressure: 100000
      battery_voltage: 3.3
    expected_quality:
      temperature: "good"
      humidity: "good"
      pressure: "good"
      battery_voltage: "good"

  - name: cold_low_pressure
    description: "Cold temperature and low pressure (high altitude)"
    # temp=-40.0 -> raw=-4000=0xF060
    # hum=20% -> raw=40=0x28
    # pres=75000Pa -> raw=7500=0x1D4C
    # batt=3.0V -> raw=3000=0x0BB8
    payload: "F0 60 28 1D 4C 0B B8"
    expected:
      temperature: -40.0
      humidity: 20.0
      pressure: 75000
      battery_voltage: 3.0
    expected_quality:
      temperature: "good"      # Exactly at min boundary is valid
      humidity: "good"
      pressure: "good"
      battery_voltage: "good"

  - name: sensor_fault_temperature
    description: "Broken temperature sensor reads extreme negative (-327.68 is s16 min)"
    # temp=-327.68 -> raw=-32768=0x8000 (s16 minimum)
    # hum=50% -> raw=100=0x64
    # pres=100000Pa -> raw=10000=0x2710
    # batt=3.3V -> raw=3300=0x0CE4
    payload: "80 00 64 27 10 0C E4"
    expected:
      temperature: -327.68
      humidity: 50.0
      pressure: 100000
      battery_voltage: 3.3
    expected_quality:
      temperature: "out_of_range"
      humidity: "good"
      pressure: "good"
      battery_voltage: "good"

  - name: overheat_condition
    description: "Temperature above valid range (100°C)"
    # temp=100.0 -> raw=10000=0x2710
    # hum=45% -> raw=90=0x5A
    # pres=100000Pa -> raw=10000=0x2710
    # batt=2.8V -> raw=2800=0x0AF0
    payload: "27 10 5A 27 10 0A F0"
    expected:
      temperature: 100.0
      humidity: 45.0
      pressure: 100000
      battery_voltage: 2.8
    expected_quality:
      temperature: "out_of_range"
      humidity: "good"
      pressure: "good"
      battery_voltage: "good"

  - name: low_battery_warning
    description: "Battery below valid operating range (1.8V)"
    # temp=23.45 -> raw=2345=0x0929
    # hum=50% -> raw=100=0x64
    # pres=100000Pa -> raw=10000=0x2710
    # batt=1.8V -> raw=1800=0x0708
    payload: "09 29 64 27 10 07 08"
    expected:
      temperature: 23.45
      humidity: 50.0
      pressure: 100000
      battery_voltage: 1.8
    expected_quality:
      temperature: "good"
      humidity: "good"
      pressure: "good"
      battery_voltage: "out_of_range"

  - name: multiple_faults
    description: "Multiple out-of-range conditions"
    # temp=-327.68 -> raw=-32768=0x8000 (below -40)
    # hum=105% -> raw=210=0xD2 (above 100)
    # pres=0Pa -> raw=0=0x0000 (below 30000)
    # batt=1.5V -> raw=1500=0x05DC (below 2.0)
    payload: "80 00 D2 00 00 05 DC"
    expected:
      temperature: -327.68
      humidity: 105.0
      pressure: 0
      battery_voltage: 1.5
    expected_quality:
      temperature: "out_of_range"
      humidity: "out_of_range"
      pressure: "out_of_range"
      battery_voltage: "out_of_range"
