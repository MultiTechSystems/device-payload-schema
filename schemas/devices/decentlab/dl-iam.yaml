# https://www.decentlab.com/products/indoor-ambiance-monitor-including-co2-tvoc-and-motion-sensor-for-lorawan
name: decentlab_dl_iam
version: 2
endian: big

fields:
  - name: protocol_version
    type: u8
  - name: device_id
    type: u16
  - name: flags
    type: u16

  - flagged:
      field: flags
      groups:
        - bit: 0
          fields:
            - name: battery_voltage
              type: u16
              div: 1000
              unit: "V"
        - bit: 1
          fields:
            - name: air_temperature
              type: u16
              unit: "Â°C"
              # formula: 175 * x[0] / 65535 - 45
            - name: air_humidity
              type: u16
              unit: "%"
              # formula: 100 * x[1] / 65535
        - bit: 2
          fields:
            - name: barometric_pressure
              type: u16
              mult: 2
              unit: "Pa"
        - bit: 3
          fields:
            - name: ambient_light_visible_infrared
              type: u16
            - name: ambient_light_infrared
              type: u16
            - name: illuminance
              type: u16
              unit: "lx"
              # formula: Math.max(Math.max(1.0 * x[0] - 1.64 * x[1], 0.59 * x[0] - 0.86 * x[1]), 0) * 1.5504
        - bit: 4
          fields:
            - name: co2_concentration
              type: u16
              add: -32768
              unit: "ppm"
            - name: co2_sensor_status
              type: u16
            - name: raw_ir_reading
              type: u16
        - bit: 5
          fields:
            - name: activity_counter
              type: u16
        - bit: 6
          fields:
            - name: total_voc
              type: u16
              unit: "ppb"
