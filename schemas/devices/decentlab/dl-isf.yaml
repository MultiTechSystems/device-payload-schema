# https://www.decentlab.com/products/sapflow-sensor-for-lorawan
name: decentlab_dl_isf
version: 2
endian: big

fields:
  - name: protocol_version
    type: u8
  - name: device_id
    type: u16
  - name: flags
    type: u16

  - flagged:
      field: flags
      groups:
        - bit: 0
          fields:
            - name: sap_flow
              type: u16
              unit: "l⋅h⁻¹"
              # formula: (x[0] * 16 - 50000) / 1000
            - name: heat_velocity_outer
              type: u16
              unit: "cm⋅h⁻¹"
              # formula: (x[1] * 16 - 50000) / 1000
            - name: heat_velocity_inner
              type: u16
              unit: "cm⋅h⁻¹"
              # formula: (x[2] * 16 - 50000) / 1000
            - name: alpha_outer
              type: u16
              # formula: (x[3] * 32 - 1000000) / 100000
            - name: alpha_inner
              type: u16
              # formula: (x[4] * 32 - 1000000) / 100000
            - name: beta_outer
              type: u16
              # formula: (x[5] * 32 - 1000000) / 100000
            - name: beta_inner
              type: u16
              # formula: (x[6] * 32 - 1000000) / 100000
            - name: tmax_outer
              type: u16
              unit: "s"
              # formula: (x[7] * 2) / 1000
            - name: tmax_inner
              type: u16
              unit: "s"
              # formula: (x[8] * 2) / 1000
            - name: temperature_outer
              type: s16
              div: 100
              unit: "°C"
            - name: max_voltage
              type: s16
              div: 1000
              unit: "V"
            - name: min_voltage
              type: s16
              div: 1000
              unit: "V"
            - name: diagnostic
              type: u32
            - name: upstream_tmax_outer
              type: u16
              unit: "s"
              # formula: (x[14] * 2) / 1000
            - name: upstream_tmax_inner
              type: u16
              unit: "s"
              # formula: (x[15] * 2) / 1000
        - bit: 1
          fields:
            - name: battery_voltage
              type: u16
              div: 1000
              unit: "V"
