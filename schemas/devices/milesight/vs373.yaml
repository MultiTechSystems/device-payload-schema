# Milesight IoT VS373
name: milesight_vs373
version: 1
endian: little

fields:
  - tlv:
      tag_fields:
        - name: channel_id
          type: u8
        - name: channel_type
          type: u8
      tag_key: [channel_id, channel_type]
      cases:
        # IPSO VERSION
        "[255, 1]":
          - name: ipso_version
            type: u8
            # raw: readProtocolVersion(bytes[i])
        # HARDWARE VERSION
        "[255, 9]":
          - name: hardware_version
            type: u8
            # raw: readHardwareVersion(bytes.slice(i, i + 2))
        # FIRMWARE VERSION
        "[255, 10]":
          - name: firmware_version
            type: u8
            # raw: readFirmwareVersion(bytes.slice(i, i + 2))
        # DEVICE STATUS
        "[255, 11]":
          - name: device_status
            type: u8
            # raw: readDeviceStatus(bytes[i])
        # LORAWAN CLASS
        "[255, 15]":
          - name: lorawan_class
            type: u8
            # raw: readLoRaWANClass(bytes[i])
        # PRODUCT SERIAL NUMBER
        "[255, 22]":
          - name: sn
            type: u8
            # raw: readSerialNumber(bytes.slice(i, i + 8))
        # TSL VERSION
        "[255, 255]":
          - name: tsl_version
            type: u8
            # raw: readTslVersion(bytes.slice(i, i + 2))
        # DETECTION TARGET (v1.0.1)
        "[3, 248]":
          - name: detection_status
            type: u8
            # raw: readDetectionStatus(bytes[i])
          - name: target_status
            type: u8
            # raw: readTargetStatus(bytes[i + 1])
          - name: use_time_now
            type: u16
          - name: use_time_today
            type: u16
        # DETECTION TARGET (v1.0.2)
        "[7, 176]":
          - name: detection_status
            type: u8
            # raw: readDetectionStatus(bytes[i])
          - name: target_status
            type: u8
            # raw: readTargetStatus(bytes[i + 1])
          - name: use_time_now
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 2, i + 5))
          - name: use_time_today
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 5, i + 8))
        # REGION OCCUPANCY (v1.0.1)
        "[4, 249]":
          - name: region_1_occupancy
            type: u8
            # raw: readOccupancyStatus(bytes[i] === 1 ? 0 : 1)
          - name: region_2_occupancy
            type: u8
            # raw: readOccupancyStatus(bytes[i + 1] === 1 ? 0 : 1)
          - name: region_3_occupancy
            type: u8
            # raw: readOccupancyStatus(bytes[i + 2] === 1 ? 0 : 1)
          - name: region_4_occupancy
            type: u8
            # raw: readOccupancyStatus(bytes[i + 3] === 1 ? 0 : 1)
        # OUT OF BED (v1.0.1)
        "[5, 250]":
          - name: region_1_out_of_bed_time
            type: u16
          - name: region_2_out_of_bed_time
            type: u16
          - name: region_3_out_of_bed_time
            type: u16
          - name: region_4_out_of_bed_time
            type: u16
        # OUT OF BED (v1.0.2) - REGION 1-3
        "[11, 180]":
          - name: region_1_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i, i + 3))
          - name: region_2_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 3, i + 6))
          - name: region_3_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 6, i + 9))
        # OUT OF BED (v1.0.2) - REGION 4-6
        "[12, 180]":
          - name: region_4_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i, i + 3))
          - name: region_5_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 3, i + 6))
          - name: region_6_out_of_bed_time
            type: u8
            # raw: readUInt24LE(bytes.slice(i + 6, i + 9))
        # BREATHING DETECTION
        "[8, 177]":
          - name: respiratory_status
            type: u8
            # raw: readBreathStatus(bytes[i])
          - name: respiratory_rate
            type: u16
            div: 100
